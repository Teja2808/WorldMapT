<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - World Map Tracker</title>
    <link rel="icon" href="images/tsquare.png" type="image/png">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@tabler/icons-webfont/tabler-icons.min.css">
    <link rel="stylesheet" href="styles/admin.css">
</head>
<body>
    <!-- Header -->
    <header class="admin-header">
        <div class="header-left">
            <img src="images/temenos figma.png" alt="Temenos Logo" class="header-logo">
            <div class="header-divider"></div>
            <span class="admin-user"><i class="ti ti-user"></i> <span id="admin-username"></span></span>
        </div>
        <div class="header-actions">
            <a href="index.html" class="btn-link"><i class="ti ti-map"></i> View Map</a>
        </div>
    </header>

    <div class="admin-wrapper">
        <!-- Left Sidebar Navigation -->
        <aside class="admin-sidebar">
            <nav class="sidebar-nav">
                <button class="nav-item active" data-tab="dashboard">
                    <i class="ti ti-dashboard"></i>
                    <span>Dashboard</span>
                </button>
                <div class="nav-section-title">Management</div>
                <button class="nav-item" data-tab="offices">
                    <i class="ti ti-building"></i>
                    <span>Offices</span>
                </button>
                <button class="nav-item" data-tab="clients">
                    <i class="ti ti-users"></i>
                    <span>Clients</span>
                </button>
                <button class="nav-item" data-tab="visits">
                    <i class="ti ti-calendar-event"></i>
                    <span>Visits</span>
                </button>
            </nav>
            <div class="sidebar-footer">
                <button onclick="logout()" class="btn-sidebar-logout">
                    <i class="ti ti-logout"></i>
                    <span>Logout</span>
                </button>
            </div>
        </aside>

        <!-- Main Content Area -->
        <main class="admin-content">
            <!-- Dashboard Tab -->
            <section id="dashboard-tab" class="tab-content active">
                <div class="section-header">
                    <h2>Dashboard</h2>
                </div>
                <div class="dashboard-grid">
                    <div class="stat-card">
                        <div class="stat-icon offices">
                            <i class="ti ti-building"></i>
                        </div>
                        <div class="stat-info">
                            <div class="stat-label">Total Offices</div>
                            <div class="stat-value" id="stat-offices">0</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon clients">
                            <i class="ti ti-users"></i>
                        </div>
                        <div class="stat-info">
                            <div class="stat-label">Total Clients</div>
                            <div class="stat-value" id="stat-clients">0</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon visits">
                            <i class="ti ti-calendar-event"></i>
                        </div>
                        <div class="stat-info">
                            <div class="stat-label">Total Visits</div>
                            <div class="stat-value" id="stat-visits">0</div>
                        </div>
                    </div>
                </div>

                <div class="recent-section">
                    <h3>Recent Client Visits</h3>
                    <div id="recent-visits" class="recent-visits-list"></div>
                </div>
            </section>

            <!-- Offices Tab -->
            <section id="offices-tab" class="tab-content">
                <div class="section-header">
                    <h2>Manage Offices</h2>
                    <button class="btn-primary" onclick="openOfficeForm()">
                        <i class="ti ti-plus"></i> Add Office
                    </button>
                </div>
                <div class="search-bar">
                    <i class="ti ti-search"></i>
                    <input type="text" id="offices-search" placeholder="Search by name, city, or country..." class="search-input">
                </div>
                <div id="offices-list" class="data-grid"></div>
            </section>

            <!-- Clients Tab -->
            <section id="clients-tab" class="tab-content">
                <div class="section-header">
                    <h2>Manage Clients</h2>
                    <button class="btn-primary" onclick="openClientForm()">
                        <i class="ti ti-plus"></i> Add Client
                    </button>
                </div>
                <div class="search-bar">
                    <i class="ti ti-search"></i>
                    <input type="text" id="clients-search" placeholder="Search by name, city, or industry..." class="search-input">
                </div>
                <div id="clients-list" class="data-grid"></div>
            </section>

            <!-- Visits Tab -->
            <section id="visits-tab" class="tab-content">
                <div class="section-header">
                    <h2>Manage Visits</h2>
                    <button class="btn-primary" onclick="openVisitForm()">
                        <i class="ti ti-plus"></i> Add Visit
                    </button>
                </div>
                <div class="search-bar">
                    <i class="ti ti-search"></i>
                    <input type="text" id="visits-search" placeholder="Search by client, office, or purpose..." class="search-input">
                </div>
                <div id="visits-list" class="data-grid"></div>
            </section>
        </main>
    </div>
    </div>

    <!-- Office Form Modal -->
    <div id="office-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="office-modal-title">Add Office</h3>
                <button class="btn-close" onclick="closeOfficeForm()">
                    <i class="ti ti-x"></i>
                </button>
            </div>
            <form id="office-form" enctype="multipart/form-data">
                <input type="hidden" id="office-id" name="officeId">
                <div class="form-grid">
                    <div class="form-group">
                        <label>Office Name *</label>
                        <input type="text" name="name" required>
                    </div>
                    <div class="form-group full-width">
                        <label>Full Address</label>
                        <input type="text" name="address" placeholder="123 Street, Area, City, Zip, Country">
                    </div>
                    <div class="form-group">
                        <label>City *</label>
                        <input type="text" name="city" required>
                    </div>
                    <div class="form-group">
                        <label>Country *</label>
                        <input type="text" name="country" required>
                    </div>
                    <div class="form-group">
                        <label>Employees</label>
                        <input type="number" name="employees" min="0">
                    </div>
                    <div class="form-group">
                        <label>Latitude *</label>
                        <input type="number" step="any" name="latitude" required placeholder="e.g., 37.7749">
                    </div>
                    <div class="form-group full-width">
                        <label>Longitude *</label>
                        <div class="input-with-btn">
                            <input type="number" step="any" name="longitude" required placeholder="e.g., -122.4194">
                            <button type="button" class="btn-primary" onclick="getFormCoordinates('office', event)">
                                Get Coordinates
                            </button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Established Year</label>
                        <input type="number" name="established" min="1900" max="2024">
                    </div>
                    <div class="form-group full-width">
                        <label>Description</label>
                        <textarea name="description" rows="3"></textarea>
                    </div>
                    <div class="form-group full-width">
                        <label>Images</label>
                        <input type="file" name="images" accept="image/*" multiple id="office-images-input">
                        <small>Upload images (JPG, PNG, GIF, WEBP)</small>
                        <div id="office-images-preview" class="images-preview"></div>
                    </div>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn-secondary" onclick="closeOfficeForm()">Cancel</button>
                    <button type="submit" class="btn-primary">Save Office</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Client Form Modal -->
    <div id="client-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="client-modal-title">Add Client</h3>
                <button class="btn-close" onclick="closeClientForm()">
                    <i class="ti ti-x"></i>
                </button>
            </div>
            <form id="client-form" enctype="multipart/form-data">
                <input type="hidden" id="client-id" name="clientId">
                <div class="form-grid">
                    <div class="form-group">
                        <label>Client Name *</label>
                        <input type="text" name="name" required>
                    </div>
                    <div class="form-group full-width">
                        <label>Full Address</label>
                        <input type="text" name="address" placeholder="Office Location, Building, Street, City, Country">
                    </div>
                    <div class="form-group">
                        <label>City *</label>
                        <input type="text" name="city" required>
                    </div>
                    <div class="form-group">
                        <label>Country *</label>
                        <input type="text" name="country" required>
                    </div>
                    <div class="form-group">
                        <label>Industry</label>
                        <input type="text" name="industry">
                    </div>
                    <div class="form-group">
                        <label>Latitude *</label>
                        <input type="number" step="any" name="latitude" required placeholder="e.g., 40.7128">
                    </div>
                    <div class="form-group full-width">
                        <label>Longitude *</label>
                        <div class="input-with-btn">
                            <input type="number" step="any" name="longitude" required placeholder="e.g., -74.0060">
                            <button type="button" class="btn-primary" onclick="getFormCoordinates('client', event)">
                                Get Coordinates
                            </button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Partnership Since</label>
                        <input type="number" name="partnershipSince" min="1900" max="2024">
                    </div>
                    <div class="form-group full-width">
                        <label>Description</label>
                        <textarea name="description" rows="3"></textarea>
                    </div>
                    <div class="form-group full-width">
                        <label>Images</label>
                        <input type="file" name="images" accept="image/*" multiple id="client-images-input">
                        <small>Upload images (JPG, PNG, GIF, WEBP)</small>
                        <div id="client-images-preview" class="images-preview"></div>
                    </div>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn-secondary" onclick="closeClientForm()">Cancel</button>
                    <button type="submit" class="btn-primary">Save Client</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Visit Form Modal -->
    <div id="visit-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="visit-modal-title">Add Visit</h3>
                <button class="btn-close" onclick="closeVisitForm()">
                    <i class="ti ti-x"></i>
                </button>
            </div>
            <form id="visit-form" enctype="multipart/form-data">
                <input type="hidden" id="visit-id" name="visitId">
                <div class="form-grid">
                    <div class="form-group">
                        <label>Office *</label>
                        <select name="officeId" id="visit-office" required>
                            <option value="">Select Office</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Client *</label>
                        <select name="clientId" id="visit-client" required>
                            <option value="">Select Client</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Visit Date *</label>
                        <input type="date" name="visitDate" required>
                    </div>
                    <div class="form-group full-width">
                        <label>Purpose</label>
                        <input type="text" name="purpose">
                    </div>
                    <div class="form-group full-width">
                        <label>Notes</label>
                        <textarea name="notes" rows="3"></textarea>
                    </div>
                    <div class="form-group full-width">
                        <label>Attendees (comma-separated)</label>
                        <input type="text" name="attendees" placeholder="John Doe, Jane Smith">
                    </div>
                    <div class="form-group full-width">
                        <label>Visit Images</label>
                        <input type="file" name="images" accept="image/*" multiple id="visit-images-input">
                        <small>Upload photos from the visit</small>
                        <div id="visit-images-preview" class="images-preview"></div>
                    </div>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn-secondary" onclick="closeVisitForm()">Cancel</button>
                    <button type="submit" class="btn-primary">Save Visit</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Custom Confirmation Modal -->
    <div id="confirm-modal" class="modal">
        <div class="modal-content confirm-box">
            <div class="confirm-header">
                <i class="ti ti-alert-triangle"></i>
                <h3>Are you sure?</h3>
            </div>
            <p id="confirm-message">Do you really want to delete this record? This action cannot be undone.</p>
            <div class="confirm-actions">
                <button class="btn-secondary" id="confirm-cancel">No, Keep it</button>
                <button class="btn-danger" id="confirm-ok">Yes, Delete</button>
            </div>
        </div>
    </div>

    <script src="js/storage.js"></script>
    <script src="js/admin.js"></script>
    <script>
        // Check authentication
        if (sessionStorage.getItem('adminLoggedIn') !== 'true') {
            window.location.href = 'login.html';
        }
        
        // Show username
        document.getElementById('admin-username').textContent = sessionStorage.getItem('adminUsername') || 'Admin';
        
        // Logout function
        function logout() {
            sessionStorage.removeItem('adminLoggedIn');
            sessionStorage.removeItem('adminUsername');
            window.location.href = 'login.html';
        }
    </script>
</body>
</html>